# Story 7.3: Create Category-Specific Analytical Views

## Status
Ready for Review

## Story
**As a** Business Analyst,
**I want** category-specific BigQuery views that maintain data purity for each AI platform type,
**so that** Metabase dashboards can query clean, focused metrics without cross-platform confusion.

## Acceptance Criteria
1. Create `vw_ai_coding_productivity` view joining Cursor + Claude Code metrics
2. Create `vw_api_consumption` view for Claude API + Cursor API token/request metrics
3. Create `vw_ai_assistant_productivity` view for claude.ai knowledge work metrics
4. Create `vw_executive_total_investment` view for cross-category analysis
5. Ensure views maintain category purity (no metric mixing between categories)
6. Test views return expected data structure for Metabase integration

## Dev Notes

### **Category-Specific View Architecture**
[Source: architecture/database-schema.md]

**View Categories:**
- **AI Coding Agents**: Cursor + Claude Code (lines of code metrics)
- **API Usage**: Claude API + Cursor API (token/request metrics)
- **AI Assistants**: claude.ai + future Gemini (conversation metrics)
- **Executive**: Cross-category totals (investment analysis)

**Join Strategy:**
- FULL OUTER JOIN on `user_email` and `usage_date`
- Platform filtering to maintain category purity
- Additive metrics within categories (e.g., cursor_lines + claude_code_lines)

### **View Specifications**
[Source: architecture/database-schema.md#category-specific-analytical-views]

**Key Join Logic:**
```sql
-- AI Coding: Only claude_code platform from Claude table
FROM fact_cursor_daily_usage c
FULL OUTER JOIN fact_claude_daily_usage cl ON (
  c.user_email = cl.user_email
  AND c.usage_date = cl.usage_date
  AND cl.platform = 'claude_code'  -- Coding only
)
```

### **File Locations**
[Source: architecture/unified-project-structure.md]
- View files location: `/sql/views/`
- Naming convention: `vw_{category}_{purpose}.sql`

## Tasks / Subtasks

- [ ] Create `sql/views/vw_ai_coding_productivity.sql` with Cursor+Claude Code join (AC: 1)
- [ ] Create `sql/views/vw_api_consumption.sql` filtering for API usage only (AC: 2)
- [ ] Create `sql/views/vw_ai_assistant_productivity.sql` for knowledge work metrics (AC: 3)
- [ ] Create `sql/views/vw_executive_total_investment.sql` for cross-category totals (AC: 4)
- [ ] Add category purity validation - ensure no metric mixing (AC: 5)
- [ ] Test each view returns correct data structure (AC: 6)
- [ ] Verify views work with existing Metabase connection (AC: 6)

## Definition of Done
- [ ] All 4 category-specific views created and tested
- [ ] Views maintain platform category separation correctly
- [ ] Cross-platform joins work without data duplication issues
- [ ] Views optimized for Metabase dashboard queries
- [ ] Simple implementation - no complex aggregations or overengineered logic

## Project Structure Notes
Views follow standard `/sql/views/` structure with descriptive naming aligned with business categories.